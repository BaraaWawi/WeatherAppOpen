//
//  CacheManagerTests.swift
//  WeatherAppOpenTests
//
//  Created by Baraa Wawi on 10/09/2024.
//

import XCTest
@testable import WeatherAppOpen

class CacheManagerTests: XCTestCase {

    var cacheManager: CacheManager!
    
    override func setUp() {
        super.setUp()
        cacheManager = CacheManager.shared
        cacheManager.clearAllCache()
    }
    
    override func tearDown() {
        cacheManager.clearAllCache()
        cacheManager = nil
        super.tearDown()
    }
    
    func testSaveAndLoadCache() {
        
        let testData = [CountryWeatherModel(city: "amman", weather: [WeatherInfoModel(mintempC: "10", maxtempC: "20", avgtempC: "15", sunHour: "9")])]
        
        
        cacheManager.saveToCache(data: testData)
        
        
        let cachedData = cacheManager.loadCachedData()
        XCTAssertNotNil(cachedData, "Expected not empty cached data")
        XCTAssertEqual(cachedData?.first?.city, "amman")
        XCTAssertEqual(cachedData?.first?.weather.first?.mintempC, "10")
    }
    
    func testClearCache() {

        let testData = [CountryWeatherModel(city: "amman", weather: [WeatherInfoModel(mintempC: "10", maxtempC: "20", avgtempC: "15", sunHour: "9")])]
        cacheManager.saveToCache(data: testData)
        
        cacheManager.clearAllCache()
        
        let cachedData = cacheManager.loadCachedData()
        XCTAssertNil(cachedData, "Expected nil cached data after clearing cache")
    }
}
